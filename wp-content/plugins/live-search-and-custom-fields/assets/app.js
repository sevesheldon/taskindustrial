function lscf_data_to_filter_subcategories(a,b,c){var d,e,f,g=lscf_return_tax_main_slug(b.ID);if(a=removeObjectKey(a,b.ID),g=lscf_return_tax_main_slug(b.ID),d=parseInt(b.value),a=removeObjectLikeKey(a,g),"undefined"!=typeof c.post_taxonomies[g]&&"undefined"!=typeof c.post_taxonomies[g].tax.subcategs_hierarchy&&"undefined"!=typeof c.post_taxonomies[g].tax.subcategs_hierarchy[d]){e=c.post_taxonomies[g].tax.subcategs_hierarchy[d];for(var h=0;h<e.length;h++)"undefined"!=typeof c.post_taxonomies[g].tax.subcategs_hierarchy[e[h]]&&(f=g+"_-_"+e[h],a[f]={ID:f,type:b.type,value:e[h],filter_as:b.filter_as})}return a}function removeObjectKey(a,b){var c={};for(var d in a)d!=b&&(c[d]=a[d]);return c}function removeObjectLikeKey(a,b){var c={};for(var d in a)-1===d.indexOf(b)&&(c[d]=a[d]);return c}function lscf_display_tax_subcategs(a){var b=jQuery;b(".lscf-taxonomies-fields").each(function(){var c=b(this).find(".px_capf-field").attr("data-id");if("undefined"==typeof a[c])return void b(this).find(".subcategs-tax").hide();var d=a[c];b(this).find(".subcategs-tax").each(function(){var a=parseInt(b(this).attr("data-parent")),c=b(this);d.indexOf(a)!=-1?c.fadeIn():(c.hide(),c.find(".styledSelect").text(capfData.options.writing.select),c.find(".px_capf-field").removeClass("active-val"),c.find('input[type="radio"]').removeAttr("checked"))})})}function lscf_return_tax_main_slug(a){var b=a;if(a.match(/(.+?)_-_([0-9]+)$/)){var c=a.match(/(.+?)_-_([0-9]+)$/);b=c[1]}return b}function lscf_reset_object_index(a){var b=[];for(var c in a){"undefined"==typeof b[c]&&(b[c]=[]);for(var d in a[c])b[c].push(a[c][d])}return b}function lscf_custom_dropdowns_update_options_classnames(){var a=jQuery;a(".pxSelectField").each(function(){var b=a(this);a(this).find("select option").each(function(c){1==a(this).attr("ng-data-disabled")?b.find(".lscf-dropdown-option").eq(c).addClass("lscf-option-disabled"):b.find(".lscf-dropdown-option").eq(c).removeClass("lscf-option-disabled")})})}function lscf_sanitize_string(a){return a=a.replace(/([\!\@\#\$\%\^\&\*\(\[\)\]\{\-\}\\\/\:\;\+\=\.\\<\,\>\?\~\`\'\" ]+)/g,"_"),a.toLowerCase()}function lscfAccordionPosts(){var a=jQuery,b=this;this.options={link_type:0},this.init=function(){return a(".lscf-posts-accordion .lscf-title").unbind("click"),"link-only"!==b.options.link_type&&void a(".lscf-posts-accordion .lscf-title").bind("click",function(b){var c=a(this).closest(".lscf-accordion-post");if(c.hasClass("active"))return c.find(".post-caption").animate({height:0},400),c.removeClass("active"),c.addClass("inactive"),!1;a(".lscf-accordion-post").removeClass("active"),a(".lscf-accordion-post").addClass("inactive"),c.addClass("active"),c.removeClass("inactive");var d=c.find(".caption").height()+40;return c.find(".post-caption").animate({height:d},400),a(".lscf-accordion-post.inactive").find(".post-caption").animate({height:0},300),b.preventDefault(),b.stopPropagation(),!1})}}function lscfSidebarCustomizator(){var a=jQuery,b=this;this.templateData={active_terms:[],settings:{run_shortcodes:{key:"run_shortcodes",value:"undefined"!=typeof capfData.options.run_shortcodes?capfData.options.run_shortcodes:0},disable_empty_option_on_filtering:{key:"disable_empty_option_on_filtering",value:"undefined"!=typeof capfData.options.disable_empty_option_on_filtering?capfData.options.disable_empty_option_on_filtering:0}},post_taxonomies:{items:[],set_tax_term_as_active:function(){return function(a,c){if(b.templateData.active_terms.length>0&&-1!==b.templateData.active_terms.indexOf(c(a)))return'checked="checked"'}}},set_settings_option_as_active:function(){return function(a,c){if(1==b.templateData.settings[c(a)].value)return'checked="checked"'}}},this.templates={},this.templates.loadTaxonomies=function(b,c){var d=capfData.plugin_url+"assets/js/templates/live-customizer/tax-template.html";a.get(d,function(d){var e=Mustache.render(a(d).filter("#template-tax").html(),b);c(e)})},this.templates.loadTemplate=function(b,c,d){a.get(c,function(c){var e=Mustache.render(a(c).filter("#template-tax").html(),b);d(e)})},this.serializeExtraOptions=function(){var c=a(".lscf-extrasidebar-template").attr("data-fields-type"),d={type:c,data:{}};switch(c){case"taxonomies-listing":d.data.post_taxonomies={};var e,f,g;b.templateData.active_terms=[],a(".lscf-taxonomies-block").each(function(){a(this).find(".px-checkbox:checked").each(function(){e=a(this).attr("data-taxonomy"),"undefined"==typeof d.data.post_taxonomies[e]&&(d.data.post_taxonomies[e]={},d.data.post_taxonomies[e].ID=e,d.data.post_taxonomies[e].group_type="taxonomies",d.data.post_taxonomies[e].tax={terms:[]}),f=parseInt(a(this).val().split("!#")[0]),g=a(this).val().split("!#")[1],d.data.post_taxonomies[e].tax.terms.push({data:{name:g,value:f}}),b.templateData.active_terms.push(f+"-"+e)})}),d.data.post_taxonomies.active_terms=b.templateData.active_terms;break;case"settings-page":d.data.settings={},a('.lscf-fronteditor-settings input[type="checkbox"]').each(function(){var c=a(this).attr("data-key");b.templateData.settings[c].value=a(this).prop("checked")?1:0,d.data.settings[c]=b.templateData.settings[c]})}return d},this.init=function(){"undefined"!=typeof capfData.settings.theme.posts_display_from&&"undefined"!=typeof capfData.settings.theme.posts_display_from.post_taxonomies&&"undefined"!=typeof capfData.settings.theme.posts_display_from.post_taxonomies.active_terms&&(b.templateData.active_terms=capfData.settings.theme.posts_display_from.post_taxonomies.active_terms),b.get_post_taxonomies_and_terms(function(a){b.templateData.post_taxonomies.items=a}),a("#lscf-expand-sidebar-extra-options, .lscf-open-extra-sidebar").click(function(){a(".lscf-close-customizer").addClass("lscf-hide"),a(".lscf-sidebar-extra-container").addClass("active");var c=a(this).closest(".lscf-sidebar-option").attr("data-type");b.loadExtraSidebarContent(c)}),a(".lscf-open-customizer").click(function(){a(this).addClass("deactivate-animations"),a(".lscf-sidebar-live-customizer").addClass("active"),a("#lscf-posts-wrapper").addClass("translate")}),a(".lscf-close-customizer").click(function(){a(".lscf-sidebar-live-customizer").removeClass("active"),a("#lscf-posts-wrapper").removeClass("translate")}),b.initCustomDropdown();var c=a(".lscf-theme-list").find('input[type="radio"]:checked').val();b.initThemeOptions(c)},this.loadExtraSidebarContent=function(c){switch(c){case"show-from-categories":b.templates.loadTaxonomies(b.templateData.post_taxonomies,function(b){a(".lscf-sidebar-extra-container-wrapper").html(b),a(".lscf-sidebar-extra-container-wrapper").customScrollbar()});break;case"filter-settings":var d=capfData.plugin_url+"assets/js/templates/live-customizer/settings-template.html";b.templates.loadTemplate(b.templateData,d,function(b){a(".lscf-sidebar-extra-container-wrapper").html(b),a(".lscf-sidebar-extra-container-wrapper").customScrollbar()})}},this.saveExtraOptions=function(c){a("#save-and-close-extra-options").click(function(){a(".lscf-close-customizer").removeClass("lscf-hide"),a(".lscf-sidebar-extra-container").removeClass("active");var d=b.serializeExtraOptions();c(d)})},this.initColorpicker=function(b){var c=!1;a(".lscf-colorpicker").colorPicker({renderCallback:function(a,d){if(!0===d&&(c=!1),!1===d&&!1===c){c=!0;var e=a[0].style.backgroundColor.replace(/rgb\(|\)/g,""),f=a[0].value;b({hex:f,rgb:e})}}})},this.generateDynamicCssColor=function(b){a.ajax({type:"POST",url:capfData.ajax_url,data:{action:"px-plugin-ajax",section:"generate-theme-color-style",color:b},success:function(a){var b=document.getElementById("px_base-inline-css");b.innerHTML=a},dataType:"html"})},this.get_post_taxonomies_and_terms=function(b){a.ajax({type:"POST",url:capfData.ajax_url,data:{action:"lscf-administrator-ajax",section:"get_taxonomies_and_terms",post_type:capfData.postType},success:function(a){b(a)},dataType:"json"})},this.saveSettings=function(b){a.ajax({type:"POST",url:capfData.ajax_url,data:{action:"lscf-administrator-ajax",section:"save-filter-settings",filter_id:capfData.ID,settings:b},success:function(a){},dataType:"html"})},this.onFormAction=function(c){var d,e,f,g,h={};a(".lscf-sidebar-option").each(function(){switch(d=a(this).attr("data-field-type")){case"dropdown":a(this).find(".options li ").each(function(){a(this).click(function(){f=a(this).attr("rel"),e=a(this).closest(".lscf-sidebar-option").attr("data-type"),h={fieldType:d,dataType:e,fieldValue:f},c(h)})});break;case"checkbox":a(this).find("#lscf-fields-ordering").click(function(){var b=a(this).closest(".lscf-check-btn");f="undefined"!=typeof b.find('input[type="checkbox"]:checked').val()?parseInt(b.find('input[type="checkbox"]:checked').val()):0,e=a(this).closest(".lscf-sidebar-option").attr("data-type"),h={fieldType:d,dataType:e,fieldValue:!f},c(h)});break;case"radiobutton":a(this).on("click",".lscf-live-customizer-radiobutton-label",function(){f=a(this).attr("data-value"),b.initThemeOptions(f),"custom-theme"==f&&(g=a(this).attr("data-index")),e="theme-style",h={fieldType:d,dataType:e,fieldValue:f,custom_theme_active_index:g},c(h)});break;case"number":a(this).find('input[type="number"]').blur(function(){f="NaN"!==parseInt(a(this).val())?parseInt(a(this).val()):15,e=a(this).closest(".lscf-sidebar-option").attr("data-type"),h={fieldType:d,dataType:e,fieldValue:f},c(h)})}})},this.initThemeOptions=function(b){switch(a(".lscf-optional-option").hide(),b){case"default":a(".lscf-optional-grid").fadeIn(),a(".lscf-optional-viewchanger").fadeIn();break;case"accordion":a(".lscf-optional-linktype").fadeIn();break;case"portrait":a(".lscf-optional-grid").fadeIn()}},this.initCustomDropdown=function(){a(".lscf-custom-select-dropwdown").each(function(){var b=a(this).attr("data-class"),c=a(this),d=a(this).children("option").length;c.addClass("s-hidden"),c.wrap('<div class="select '+b+'"></div>'),c.after('<div class="styledSelect"></div>');var e=c.next("div.styledSelect"),f=c.find("option:selected")?c.find("option:selected").text():c.children("option").eq(0).text();e.text(f);for(var g=a("<ul />",{class:"options"}).insertAfter(e),h=0;h<d;h++){var i=0===h?"pxselect-hidden-list":"";a("<li />",{text:c.children("option").eq(h).text(),rel:c.children("option").eq(h).val(),class:i}).appendTo(g)}var j=g.children("li");e.click(function(b){b.stopPropagation(),a("div.styledSelect.active").each(function(){a(this).removeClass("active").next("ul.options").hide()}),a(this).toggleClass("active").next("ul.options").toggle()}),j.click(function(b){j.removeClass("pxselect-hidden-list"),a(this).addClass("pxselect-hidden-list"),b.stopPropagation(),e.text(a(this).text()).removeClass("active"),c.val(a(this).attr("rel")),g.hide()}),a(document).click(function(){e.removeClass("active"),g.hide()})})}}var angAppName="",appElems=document.querySelectorAll("[ng-app]");appElems.length>=1?(angAppName=appElems[0].getAttribute("ng-app"),"px-capf"==angAppName&&angular.module("px-capf",["ngSanitize","ngAnimate"]).config(["$sceDelegateProvider",function(a){a.resourceUrlWhitelist(["self",capfData.plugin_url+"**"])}])):(angAppName="px-capf",angular.module("px-capf",["ngSanitize","ngAnimate"]).config(["$sceDelegateProvider",function(a){a.resourceUrlWhitelist(["self",capfData.plugin_url+"**"])}])),angular.module(angAppName).controller("pxfilterController",["$scope","customFilterService",function(a,b){var c,d,e,f,g,h,i=capfData.post_per_page,j=1,k=capfData.ID,l="",m=capfData.postType,o=new px_customRange,p=new customSelectBox,q=new lscfOrderFilterFields,r=null,s=new pxFilterFieldsAction;a.loading=!1,a.noResults=!1,a.morePostsAvailable=!1,a.featuredLabel=!1,a.postType=m,a.existsPosts=!1,a.filterPostsTemplate={},a.directiveInfo={},a.liveSearchTemplate={class:""},a.actionSettings={customFields:[],pxCurrentPage:j,postsPerPage:i,activeTerms:[],postsCount:"",pagesCount:"",activeQuery:[],filterPostsTemplate:[],previousSidebarPosition:"",disableInactiveTerms:!1,initSidebar:!1,initPostTheme:!1,initFieldsDraggable:!1,isAdministrator:"undefined"!=typeof capfData.settings.is_administrator?parseInt(capfData.settings.is_administrator):0},a.lscfSidebar={},a.loadMoreBtn={morePostsAvailable:!1,noResults:!1,loading:!1,postsLoading:!1,ready:!0,type:"default"},a.pluginSettings={className:{sidebar:"",posts_theme:""},existsPosts:!0,pluginPath:capfData.plugin_url,filterSettings:capfData.settings,generalSettings:capfData.options},a.makeWrapperClassName=function(){var b={sidebar:"",posts_theme:""};return"top"==a.pluginSettings.filterSettings.theme.sidebar.position||"0"==a.pluginSettings.filterSettings.theme.sidebar.position?(b.sidebar="col-sm-12 col-md-12 col-lg-12 lscf-horizontal-sidebar ",b.posts_theme="col-sm-12 col-md-12 col-lg-12 lscf-wide-posts "):(b.sidebar=capfData.settings.theme.columns>3?"col-sm-2 col-md-2 col-lg-2 ":"col-sm-3 col-md-3 col-lg-3 ",b.posts_theme=capfData.settings.theme.columns>3?"col-sm-10 col-md-10 col-lg-10 ":"col-sm-9 col-md-9 col-lg-9 "),b},a.$watch("actionSettings.postsPerPage",function(c,d){c!=d&&b.getPosts(m,a.actionSettings.postsPerPage,j,a.actionSettings.activeQuery).success(function(b){a.actionSettings.postsCount=b.postsCount,a.actionSettings.pagesCount=b.pages,a.actionSettings.pxCurrentPage=j+1,a.actionSettings.pxCurrentPage>b.pages&&(a.loadMoreBtn.morePostsAvailable=!1),a.loadMoreBtn.loading=!1,a.actionSettings.filterPostsTemplate=b.posts,a.filterPostsTemplate.posts=a.actionSettings.filterPostsTemplate,a.directiveInfo.afterPostsLoadCallback()})}),a.$watch("actionSettings.initFieldsDraggable",function(a,b){!0===a&&(q.fieldsData={fields:c.default_data.fields,filterID:k},setTimeout(function(){q.draggable.initFilterFields()},300)),!1===a&&q.draggable.unbindOrder()}),a.$watch("actionSettings.initPostTheme",function(b,c){!0===b&&(a.actionSettings.initPostTheme=!1,a.directiveInfo.ready())}),f=a.makeWrapperClassName(a.pluginSettings.filterSettings.theme.sidebar.position),a.pluginSettings.className.sidebar=f.sidebar,a.pluginSettings.className.posts_theme=f.posts_theme,a.load_more=function(){if(a.loadMoreBtn.loading=!0,"range"==a.loadMoreBtn.type){for(var c=a.actionSettings.rangeCurrentPage,d=a.actionSettings.postsPerPage,e=parseInt(c)*parseInt(d),f=[],g=e;g<a.matched_posts.length&&("undefined"!=typeof a.matched_posts[g]&&g<e+parseInt(d));g++)f.push(a.matched_posts[g]);return a.matched_posts.length<=e+parseInt(d)?a.loadMoreBtn.morePostsAvailable=!1:a.loadMoreBtn.morePostsAvailable=!0,a.actionSettings.filterPostsTemplate=a.actionSettings.filterPostsTemplate.concat(f),a.filterPostsTemplate.posts=a.actionSettings.filterPostsTemplate,a.directiveInfo.afterPostsLoadCallback(),a.actionSettings.rangeCurrentPage+=1,void(a.loadMoreBtn.loading=!1)}var h=a.actionSettings.customFields;null!==r&&0===h.length&&(h=r),b.getPosts(m,a.actionSettings.postsPerPage,a.actionSettings.pxCurrentPage,h).success(function(b){a.actionSettings.postsCount=b.postsCount,a.actionSettings.pagesCount=b.pages,a.actionSettings.pxCurrentPage+=1,a.actionSettings.pxCurrentPage>b.pages&&(a.loadMoreBtn.morePostsAvailable=!1),a.loadMoreBtn.loading=!1,a.actionSettings.filterPostsTemplate=a.actionSettings.filterPostsTemplate.concat(b.posts),a.filterPostsTemplate.posts=a.actionSettings.filterPostsTemplate,a.directiveInfo.afterPostsLoadCallback()})},b.getSidebar().success(function(b){a.lscfSidebar.html=b}),b.getFilterFields(k).success(function(f){if(console.log(f),l=f.filter_type,"undefined"!=typeof f.default_data.custom_templates&&(a.pluginSettings.custom_templates=f.default_data.custom_templates),"undefined"!=typeof f.default_data.settings.theme.posts_display_from&&"undefined"!==f.default_data.settings.theme.posts_display_from.post_taxonomies.active_terms&&f.default_data.settings.theme.posts_display_from.post_taxonomies.active_terms.length>0){var i={default_filter:{}};"undefined"!=typeof f.fields&&(i.default_filter.fields=f.fields),i.default_filter.post_taxonomies=f.default_data.settings.theme.posts_display_from.post_taxonomies,r=i,b.getPosts(m,a.actionSettings.postsPerPage,j,i).success(function(b){a.actionSettings.activeTerms=b.active_terms,a.actionSettings.postsHasLoaded=!0,a.filterPostsTemplate.filter_type=b.filter_type,b.postsCount<1&&(a.pluginSettings.existsPosts=!1),b.posts.length>0?a.loadMoreBtn.noResults=!1:a.loadMoreBtn.noResults=!0,1===b.featuredLabel&&(a.featuredLabel=!0),a.actionSettings.postsCount=b.postsCount,a.actionSettings.pagesCount=b.pages,a.actionSettings.pxCurrentPage=j+1,a.allPostsCount=b.postsCount,a.actionSettings.pxCurrentPage<=b.pages&&(a.loadMoreBtn.morePostsAvailable=!0),e=a.loadMoreBtn.morePostsAvailable,a.actionSettings.filterPostsTemplate=b.posts,d=b.posts,a.filterPostsTemplate.posts=a.actionSettings.filterPostsTemplate,a.directiveInfo.ready(),a.directiveInfo.afterPostsLoadCallback(),a.loadMoreBtn.postsLoading=!1,r=null})}else b.getPosts(m,a.actionSettings.postsPerPage,j,null).success(function(b){a.actionSettings.activeTerms=b.active_terms,a.filterPostsTemplate.filter_type=b.filter_type,b.postsCount<1&&(a.pluginSettings.existsPosts=!1),b.posts.length>0?a.loadMoreBtn.noResults=!1:a.loadMoreBtn.noResults=!0,1===b.featuredLabel&&(a.featuredLabel=!0),a.actionSettings.postsCount=b.postsCount,a.actionSettings.pagesCount=b.pages,a.actionSettings.pxCurrentPage=j+1,a.allPostsCount=b.postsCount,a.actionSettings.pxCurrentPage<=b.pages&&(a.loadMoreBtn.morePostsAvailable=!0),e=a.loadMoreBtn.morePostsAvailable,a.actionSettings.filterPostsTemplate=b.posts,d=b.posts,a.filterPostsTemplate.posts=a.actionSettings.filterPostsTemplate,a.directiveInfo.ready(),a.directiveInfo.afterPostsLoadCallback(),a.loadMoreBtn.postsLoading=!1});var k=[];if(null!==r)for(var q=0;q<r.default_filter.post_taxonomies.active_terms.length;q++)for(var t=r.default_filter.post_taxonomies.active_terms[q].match(/^([0-9]+)-(.*)/),u=parseInt(t[1]),v=t[2],w=0;w<f.fields.length;w++)if("taxonomies"==f.fields[w].group_type&&"undefined"!=typeof f.fields[w].tax&&f.fields[w].tax.slug==v)for(var x=0;x<f.fields[w].tax.terms.length;x++){var y=f.fields[w].tax.terms[x];u==y.data.value?f.fields[w].tax.terms[x].checked=!0:f.fields[w].tax.terms[x].checked=!1}c=f,a.filterFieldsTemplate=c,a.actionSettings.initSidebar=!0,a.$watch("actionSettings.initSidebar",function(i,l){if(g="left"==a.pluginSettings.filterSettings.theme.sidebar.position||"top"==a.pluginSettings.filterSettings.theme.sidebar.position?1:2,"left"==a.actionSettings.previousSidebarPosition||"top"==a.actionSettings.previousSidebarPosition?h=1:""!==a.actionSettings.previousSidebarPosition&&(h=2),!0===i){if(a.actionSettings.initSidebar=!1,a.actionSettings.previousSidebarPosition=a.pluginSettings.filterSettings.theme.sidebar.position,g===h)return;p.construct(),s.construct(function(g){j=1;var h="add";if(a.loadMoreBtn.postsLoading=!0,g.constructor!==Array){var i=[];i[0]=g,g=i}g.forEach(function(b){switch(b.type){case"date-interval":if(""===b.fields.from||""===b.fields.to)return;break;case"checkbox_post_terms":0===b.value.length&&(h="remove");break;case"px_icon_check_box":case"checkbox":0===b.value.length&&(k=removeObjectKey(k,b.ID),h="remove");break;case"select":b.value.constructor===Array?sVal=b.value[0]:sVal=b.value,"select"==sVal.toLowerCase()||"0"==sVal?(k=removeObjectKey(k,b.ID),k=removeObjectLikeKey(k,b.ID),h="remove"):"checkbox_post_terms"==b.filter_as&&(k=lscf_data_to_filter_subcategories(k,b,c));break;case"radio":b.value.constructor===Array?sVal=b.value[0]:sVal=b.value,"0"==sVal?(k=removeObjectKey(k,b.ID),h="remove"):"checkbox_post_terms"==b.filter_as&&(k=lscf_data_to_filter_subcategories(k,b,c));break;case"date":""===b.value&&(k=removeObjectKey(k,b.ID),h="remove")}"add"==h&&(k[b.ID]=b,a.loadMoreBtn.type="default")});var l,o=[],p=[];for(var q in k){var t=k[q];if("undefined"!=typeof t.ID&&(o.push(t),"undefined"!=typeof t.filter_as&&"checkbox_post_terms"==t.filter_as)){var u,v=lscf_return_tax_main_slug(t.ID);if("undefined"==typeof p[v]&&(p[v]=[]),Array===t.value.constructor)for(var w=0;w<t.value.length;w++){if("undefined"!=typeof f.post_taxonomies[v]&&"undefined"!=typeof f.post_taxonomies[v].tax.subcategs_hierarchy&&"undefined"!=typeof f.post_taxonomies[v].tax.subcategs_hierarchy[t.value[w]])for(l=f.post_taxonomies[v].tax.subcategs_hierarchy[t.value[w]],n=0;n<l.length;n++)u=parseInt(l[n]),p[v][u]=u;u=parseInt(t.value[w]),p[v][u]=u}else if(u=parseInt(t.value),p[v][u]=u,"undefined"!=typeof f.post_taxonomies[v]&&"undefined"!=typeof f.post_taxonomies[v].tax.subcategs_hierarchy&&"undefined"!=typeof f.post_taxonomies[v].tax.subcategs_hierarchy[t.value])for(l=f.post_taxonomies[v].tax.subcategs_hierarchy[t.value],n=0;n<l.length;n++)u=parseInt(l[n]),p[v][u]=u}}p=lscf_reset_object_index(p),lscf_display_tax_subcategs(p),null!==r&&0===o.length&&(o=r),a.actionSettings.activeQuery=o,b.getPosts(m,a.actionSettings.postsPerPage,j,o).success(function(b){if(b.active_terms.length>0){a.actionSettings.disableInactiveTerms=!0;for(var c=a.filterFieldsTemplate.fields,d=0;d<c.length;d++)if("taxonomies"==c[d].group_type)for(var e=0;e<c[d].tax.terms.length;e++){var f=c[d].tax.terms[e].data.value;"undefined"==typeof b.active_terms[f]?c[d].tax.terms[e].data.not_active=!0:c[d].tax.terms[e].data.not_active=!1}else if("custom_field"==c[d].group_type&&"undefined"!=typeof b.active_terms.custom_fields&&"undefined"!=typeof c[d].options)for(var g=0;g<c[d].options.length;g++){var h=c[d].ID+lscf_sanitize_string(c[d].options[g].opt);"undefined"==typeof b.active_terms.custom_fields[h]?c[d].options[g].not_active=!0:c[d].options[g].not_active=!1}a.filterFieldsTemplate.fields=c,setTimeout(function(){lscf_custom_dropdowns_update_options_classnames()},500)}else a.actionSettings.disableInactiveTerms=!1,setTimeout(function(){lscf_custom_dropdowns_update_options_classnames()},500);b.posts.length>0?a.loadMoreBtn.noResults=!1:a.loadMoreBtn.noResults=!0,a.actionSettings.activeTerms=b.active_terms,a.actionSettings.postsCount=b.postsCount,a.actionSettings.pagesCount=b.pages,a.actionSettings.pxCurrentPage=j+1,a.actionSettings.customFields=o,a.actionSettings.pxCurrentPage<=b.pages?a.loadMoreBtn.morePostsAvailable=!0:a.loadMoreBtn.morePostsAvailable=!1,a.actionSettings.filterPostsTemplate=b.posts,a.filterPostsTemplate.posts=b.posts,a.loadMoreBtn.postsLoading=!1,a.directiveInfo.afterPostsLoadCallback()}),a.reset_filter=function(){s.reset_fields(),a.filterPostsTemplate.posts=d,a.actionSettings.filterPostsTemplate=d,a.loadMoreBtn.morePostsAvailable=e,k=[],a.actionSettings.customFields=[],a.actionSettings.pxCurrentPage=2,a.loadMoreBtn.noResults=!1,a.directiveInfo.afterPostsLoadCallback()}})}}),o.construct(function(c){j=1,k[c.ID]=c,"px-woocommerce-price"!==c.ID&&"px-woocommerce-inventory"!==c.ID&&(a.loadMoreBtn.type="range");var d=[];for(var e in k)"undefined"!=typeof k[e].ID&&d.push(k[e]);a.loadMoreBtn.postsLoading=!0,a.actionSettings.rangeCurrentPage=2,b.getPosts(m,a.actionSettings.postsPerPage,j,d).success(function(b){b.posts.length>0?a.loadMoreBtn.noResults=!1:a.loadMoreBtn.noResults=!0,a.actionSettings.activeTerms=b.active_terms,a.matched_posts=b.matched_posts,a.actionSettings.postsCount=b.postsCount,a.actionSettings.pagesCount=b.pages,a.actionSettings.pxCurrentPage=j+1,a.actionSettings.customFields=d,a.actionSettings.pxCurrentPage<=b.pages?a.loadMoreBtn.morePostsAvailable=!0:a.loadMoreBtn.morePostsAvailable=!1,a.actionSettings.filterPostsTemplate=b.posts,a.filterPostsTemplate.posts=b.posts,a.directiveInfo.afterPostsLoadCallback(),a.loadMoreBtn.postsLoading=!1})})})}]),angular.module(angAppName).factory("capfAPI",["$http",function(a){var b=pxData.ajaxURL+"?action=px-ang-http";return{uri:b}}]),angular.module(angAppName).factory("customFilterService",["$http","capfAPI",function(a,b){function c(c){return a({method:"post",url:b.uri,data:{section:"getFilterFields",filter_id:c}})}function d(){return a({method:"post",url:b.uri,data:{section:"getSidebar"}})}function e(c,d,e,f){return a({method:"post",url:b.uri,data:{section:"getPosts",post_type:c,featured_label:capfData.featuredLabel,limit:d,page:e,q:f,filter_id:capfData.ID}})}return{getFilterFields:c,getPosts:e,getSidebar:d}}]),angular.module(angAppName).directive("viewmodeAccordion",["customFilterService",function(a){return{restrict:"AE",scope:!0,bindToController:!0,controllerAs:"vm",templateUrl:capfData.plugin_url+"app/views/posts-accordion.html",link:function(a,b,c){var d=new lscfAccordionPosts;a.actionSettings.initPostTheme=!0,a.directiveInfo.ready=function(){d.options.link_type="undefined"!=typeof a.pluginSettings.filterSettings.theme.link_type?a.pluginSettings.filterSettings.theme.link_type:0,setTimeout(function(){d.init()},500)},a.directiveInfo.afterPostsLoadCallback=function(){setTimeout(function(){d.init()},500)}}}}]),angular.module(angAppName).directive("ajaxSearch",["customFilterService",function(a){return{restrict:"AE",require:"?ngModel",scope:!0,bindToController:!0,controllerAs:"vm",link:function(b,c,d,e){var f=d.searchType;c.bind("keydown keypress",function(c){if(13===c.which){var d,e,g={},h=!1;switch(f){case"general-search":d=b.pxsearch,h=!1;for(var i=0;j<b.actionSettings.customFields.length;j++)e=b.actionSettings.customFields[i],"ajax-main-search"==e.ID&&(b.actionSettings.customFields[i].value=d,h=!0);!1===h&&(g={ID:"ajax-main-search",filter_as:null,type:"main-search",value:d},b.actionSettings.customFields.push(g));break;case"woo-product-sku":d=b.pxsearch_woo_sku,h=!1;for(var j=0;j<b.actionSettings.customFields.length;j++)e=b.actionSettings.customFields[j],"ajax-product-sku-search"==e.ID&&(b.actionSettings.customFields[j].value=d,h=!0);!1===h&&(g={ID:"ajax-product-sku-search",filter_as:null,type:"main-search",value:d},b.actionSettings.customFields.push(g))}b.loadMoreBtn.postsLoading=!0,a.getPosts(b.postType,b.postsPerPage,1,b.actionSettings.customFields).success(function(a){b.actionSettings.postsCount=a.postsCount,b.actionSettings.pagesCount=a.pages,b.actionSettings.pxCurrentPage=2,b.actionSettings.pxCurrentPage<=a.pages?b.loadMoreBtn.morePostsAvailable=!0:b.loadMoreBtn.morePostsAvailable=!1,b.actionSettings.filterPostsTemplate=a.posts,b.filterPostsTemplate.posts=a.posts,b.loadMoreBtn.postsLoading=!1,b.directiveInfo.afterPostsLoadCallback()}),c.preventDefault()}})}}}]),angular.module(angAppName).directive("viewmodeCustom",["customFilterService",function(a){return{restrict:"AE",scope:!0,bindToController:!0,controllerAs:"vm",link:function(a,b,c){a.directiveInfo.ready=function(){},a.directiveInfo.afterPostsLoadCallback=function(){}},template:'<div ng-include="pluginSettings.filterSettings.theme.custom_template.url">'}}]),angular.module(angAppName).directive("viewmodeDefault",["customFilterService",function(a){return{restrict:"AE",scope:!0,bindToController:!0,controllerAs:"vm",templateUrl:capfData.plugin_url+"app/views/posts-default.html",link:function(a,b,c){a.actionSettings.initPostTheme=!0;var d=new lscfPosts;a.directiveInfo.ready=function(){d.init(),d.constructHover(),"undefined"!=typeof capfData.settings&&"undefined"!=typeof capfData.settings.theme&&("undefined"!=typeof capfData.settings.theme.viewchanger&&"undefined"!=typeof capfData.settings.theme.viewchanger.list&&1!=capfData.settings.theme.viewchanger.grid&&1==capfData.settings.theme.viewchanger.list||(jQuery(".lscf-posts-block").addClass("block-view"),jQuery(".viewMode > div").removeClass("active"),jQuery(".viewMode #blockView").addClass("active")))},a.directiveInfo.afterPostsLoadCallback=function(){d.constructHover()}}}}]),angular.module(angAppName).directive("liveSearch",["customFilterService",function(a){return{restrict:"AE",require:"?ngModel",scope:!0,bindToController:!0,controllerAs:"vm",link:function(b,c,d,e){var f=null;"undefined"!=typeof capfData.settings.theme.posts_display_from&&"undefined"!==capfData.settings.theme.posts_display_from.post_taxonomies.active_terms&&capfData.settings.theme.posts_display_from.post_taxonomies.active_terms.length>0&&(f={default_filter:{}},f.default_filter.post_taxonomies=capfData.settings.theme.posts_display_from.post_taxonomies),a.getPosts(b.postType,200,1,f).success(function(a){lscfPostsList=new lscfPosts,posts=a.posts,b.$watch("pxsearch",function(a,c){if("undefined"!=typeof a&&a!=c){b.$parent.loadMoreBtn.morePostsAvailable=!1;var d=[];""!==a&&"undefined"!=typeof posts?posts.forEach(function(b){var c=pxDecodeEntities(b.title.long.replace(/(<strong(.*?)class\=\"matched-word\"\>)|(<\/strong\>)/gi,"")),e=pxDecodeEntities(b.title.short.replace(/(<strong(.*?)class\=\"matched-word\"\>)|(<\/strong\>)/gi,"")),f=pxDecodeEntities(b.content.replace(/(<strong(.*?)class\=\"matched-word\"\>)|(<\/strong\>)/gi,""));a.toLowerCase()==e.toLowerCase()?b.class_name="ls-matches-search":b.class_name="",c.toLowerCase().indexOf(a.toLowerCase())==-1&&b.full_content.toLowerCase().indexOf(a.toLowerCase())==-1||(c=c.replace(new RegExp(a,"ig"),'<strong class="matched-word">'+a+"</strong>"),e=e.replace(new RegExp(a,"ig"),'<strong class="matched-word">'+a+"</strong>"),f=f.replace(new RegExp(a,"ig"),'<strong class="matched-word">'+a+"</strong>"),b.title.long=c,b.title.short=e,b.content=f,d.push(b))}):"undefined"!=typeof posts&&posts.forEach(function(a){var b=a.title.long.replace(/(<strong(.*?)class\=\"matched-word\"\>)|(<\/strong\>)/gi,""),c=a.title.short.replace(/(<strong(.*?)class\=\"matched-word\"\>)|(<\/strong\>)/gi,""),e=a.content.replace(/(<strong(.*?)class\=\"matched-word\"\>)|(<\/strong\>)/gi,"");a.title.long=b,a.title.short=c,a.content=e,d.push(a)}),b.$parent.filterPostsTemplate.posts=d,lscfPostsList.constructHover()}}),b.$watch("pxsearch_woo_sku",function(a,c){if("undefined"!=typeof a&&a!=c){b.$parent.loadMoreBtn.morePostsAvailable=!1;var d=[];""!==a?posts.forEach(function(b){"undefined"!=typeof b.woocommerce.sku&&b.woocommerce.sku.toLowerCase().indexOf(a.toLowerCase())!=-1&&d.push(b)}):"undefined"!==posts&&posts.forEach(function(a){d.push(a)}),b.$parent.filterPostsTemplate.posts=d,lscfPostsList.constructHover()}})})}}}]),angular.module(angAppName).directive("viewmodePortrait",["customFilterService",function(a){return{restrict:"AE",scope:!0,bindToController:!0,controllerAs:"vm",templateUrl:capfData.plugin_url+"app/views/posts-portrait.html",link:function(a,b,c){a.actionSettings.initPostTheme=!0,a.directiveInfo.ready=function(){},a.directiveInfo.afterPostsLoadCallback=function(){}}}}]),angular.module(angAppName).directive("sidebarLiveCustomizer",["customFilterService",function(a){return{restrict:"AE",require:"?ngModel",scope:!0,bindToController:!0,controllerAs:"vm",templateUrl:capfData.plugin_url+"app/views/sidebar-live-customizer.html",link:function(a,b,c,d){a.$watch("pluginSettings.custom_templates",function(b,c){if("undefined"!=typeof a.pluginSettings.filterSettings.theme.custom_template&&"undefined"!=typeof a.pluginSettings.custom_templates&&"custom-theme"==a.pluginSettings.filterSettings.theme.display)for(var d=0;d<a.pluginSettings.custom_templates.length;d++)a.pluginSettings.filterSettings.theme.custom_template.slug==a.pluginSettings.custom_templates[d].slug?a.pluginSettings.custom_templates[d].checked=!0:a.pluginSettings.custom_templates[d].checked=!1});var e,f,g=new lscfSidebarCustomizator;setTimeout(function(){g.init(),g.initColorpicker(function(b){g.generateDynamicCssColor(b),a.$apply(function(){a.pluginSettings.filterSettings["main-color"]=b.hex,a.pluginSettings.filterSettings["main-color-rgb"]=b.rgb,e=angular.toJson(a.pluginSettings),g.saveSettings(e)})}),g.saveExtraOptions(function(b){a.$apply(function(){switch(b.type){case"taxonomies-listing":a.pluginSettings.filterSettings.theme.posts_display_from=b.data;break;case"settings-page":a.pluginSettings.generalSettings.run_shortcodes=g.templateData.settings.run_shortcodes.value,a.pluginSettings.generalSettings.disable_empty_option_on_filtering=g.templateData.settings.disable_empty_option_on_filtering.value}e=angular.toJson(a.pluginSettings),g.saveSettings(e)})}),g.onFormAction(function(b){switch(b.dataType){case"order-fields":a.$apply(function(){a.actionSettings.initFieldsDraggable=b.fieldValue});break;case"sidebar-position":a.$apply(function(){a.pluginSettings.filterSettings.theme.sidebar.position=b.fieldValue,a.actionSettings.initSidebar=!0,f=a.makeWrapperClassName(),a.pluginSettings.className.sidebar=f.sidebar,
a.pluginSettings.className.posts_theme=f.posts_theme});break;case"theme-style":a.$apply(function(){if(a.pluginSettings.filterSettings.theme.display=b.fieldValue,"custom-theme"==b.fieldValue){var c=parseInt(b.custom_theme_active_index);"undefined"==typeof a.pluginSettings.filterSettings.theme.custom_template&&(a.pluginSettings.filterSettings.theme.custom_template={}),a.pluginSettings.filterSettings.theme.custom_template.url=a.pluginSettings.custom_templates[c].url,a.pluginSettings.filterSettings.theme.custom_template.name=a.pluginSettings.custom_templates[c].name,a.pluginSettings.filterSettings.theme.custom_template.slug=a.pluginSettings.custom_templates[c].slug}});break;case"columns-number":var c=parseInt(b.fieldValue);a.$apply(function(){a.pluginSettings.filterSettings.theme.columns=c,a.pluginSettings.className.sidebar=c>3?"col-sm-2 col-md-2 col-lg-2":"col-sm-3 col-md-3 col-lg-3",a.pluginSettings.className.posts_theme=c>3?"col-sm-10 col-md-10 col-lg-10":"col-sm-9 col-md-9 col-lg-9"});break;case"view-changer":switch(b.fieldValue){case"full":a.$apply(function(){a.pluginSettings.filterSettings.theme.viewchanger.grid=1,a.pluginSettings.filterSettings.theme.viewchanger.list=1}),jQuery(".viewMode").fadeIn(),jQuery(".lscf-posts-block").addClass("block-view"),jQuery(".viewMode > div").removeClass("active"),jQuery(".viewMode #blockView").addClass("active");break;case"list":a.$apply(function(){a.pluginSettings.filterSettings.theme.viewchanger.grid=0,a.pluginSettings.filterSettings.theme.viewchanger.list=1}),jQuery(".viewMode").hide(),jQuery(".lscf-posts-block").removeClass("block-view");break;case"grid":a.$apply(function(){a.pluginSettings.filterSettings.theme.viewchanger.grid=1,a.pluginSettings.filterSettings.theme.viewchanger.list=0}),jQuery(".viewMode").hide(),jQuery(".lscf-posts-block").addClass("block-view")}break;case"link-type":a.$apply(function(){a.pluginSettings.filterSettings.theme.link_type=b.fieldValue,a.actionSettings.initPostTheme=!0});break;case"posts-per-page":a.$apply(function(){a.actionSettings.postsPerPage=b.fieldValue})}e=angular.toJson(a.pluginSettings),g.saveSettings(e)})},800)}}}]);